<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Customer Intelligence Tool for Rapid Understandable Segmentation • citrus</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Customer Intelligence Tool for Rapid Understandable Segmentation">
<meta property="og:description" content="A tool to easily run and visualise supervised and unsupervised state of the art customer segmentation.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">citrus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="citrus---customer-intelligence-tool-for-rapid-understandable-segmentation" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#citrus---customer-intelligence-tool-for-rapid-understandable-segmentation" class="anchor"></a>CITRUS - Customer Intelligence Tool for Rapid Understandable Segmentation</h1></div>
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>Customer segmentation is the process of dividing customers into groups based on common characteristics so companies can market to each group effectively and appropriately. <strong>CITRUS</strong> is a package developed by Peak to provide easy and understable segmentation utilities.</p>
</div>
<div id="contributing" class="section level2">
<h2 class="hasAnchor">
<a href="#contributing" class="anchor"></a>Contributing</h2>
<p>If you are interested in contributing to the package, please follow guidelines found <a href="https://github.com/PeakBI/citrus/blob/main/.github/CONTRIBUTING.md">here</a></p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"peak-ai/citrus"</span><span class="op">)</span></code></pre></div>
</div>
<div id="expected-data-model" class="section level2">
<h2 class="hasAnchor">
<a href="#expected-data-model" class="anchor"></a>Expected Data Model</h2>
<p>In its current state, we are assuming that the input data is a transactions table with 4 required columns (transactionid, customerid, orderdate, transactionvalue). The preprocess function requires that these fields (or equivalent fields) are named in that manner. The function will raise a warning if these column names are not found.</p>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>Using the segmentation functions could be as simple as calling a one-liner:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/segment.html">segment</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="reference/transactional_data.html">transactional_data</a></span>, 
                  modeltype <span class="op">=</span> <span class="st">'tree'</span>,
                  steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'preprocess'</span>,<span class="st">'model'</span><span class="op">)</span>,
                  prettify <span class="op">=</span> <span class="cn">TRUE</span>,
                  print_plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>The above code uses default hyperparameters. There are two types of hyperparameters in this package, global ones and method specific ones. Global ones are independent of the method chosen and the method specific ones are related to the approach taken (eg. size of tree).</p>
<div id="hyperparameters" class="section level3">
<h3 class="hasAnchor">
<a href="#hyperparameters" class="anchor"></a>Hyperparameters</h3>
<p>Hyperparameters can be passed into the functions at any time, most of the modules of the CITRUS pipeline has <code>hyperparameters</code> as a function input. The hyperparameters should be passed as a list as follows</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hyperparameters</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dependent_variable <span class="op">=</span> <span class="st">'response'</span>,
                       min_segmentation_fraction <span class="op">=</span> <span class="fl">0.05</span>,
                       number_of_personas <span class="op">=</span> <span class="fl">6</span>,
                       print_safety_check<span class="op">=</span><span class="fl">20</span><span class="op">)</span></code></pre></div>
<p>or for unsupervised k-means/modes</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hyperparameters</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>centers <span class="op">=</span> <span class="st">'auto'</span>,
                       iter_max <span class="op">=</span> <span class="fl">50</span>,
                       nstart <span class="op">=</span> <span class="fl">5</span>,
                       max_centers <span class="op">=</span> <span class="fl">5</span>, 
                       segmentation_variables <span class="op">=</span> <span class="cn">NULL</span>,
                       standardize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<center>
<table class="table">
<colgroup>
<col width="7%">
<col width="12%">
<col width="22%">
<col width="57%">
</colgroup>
<thead><tr class="header">
<th>Type</th>
<th>Method</th>
<th>Hyperparameter Name</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Global</td>
<td></td>
<td>segmentation_variables</td>
<td>
<code>array</code>, names of all variables to segment on</td>
</tr>
<tr class="even">
<td>Global</td>
<td></td>
<td>saveoutput</td>
<td>
<code>boolean</code>, saves the output to local directory if TRUE</td>
</tr>
<tr class="odd">
<td>Method</td>
<td>tree</td>
<td>dependent_variable</td>
<td>
<code>character</code>, name of the variable to be used as dependent variable</td>
</tr>
<tr class="even">
<td>Method</td>
<td>tree</td>
<td>min_segmentation_fraction</td>
<td>
<code>numeric</code>, the maximum size of the smallest possible segment (0.05 is 5% of the number of customers passed)</td>
</tr>
<tr class="odd">
<td>Method</td>
<td>tree</td>
<td>number_of_personas</td>
<td>
<code>numeric</code>, the number of segments to be produced</td>
</tr>
<tr class="even">
<td>Method</td>
<td>unsupervised</td>
<td>centers</td>
<td>
<code>numeric</code> or <code>string</code>, either the number of clusters, or a set of initial (distinct) cluster centres, or ‘auto’. When ‘auto’ is chosen, the number of clusters is optimised</td>
</tr>
<tr class="odd">
<td>Method</td>
<td>unsupervised</td>
<td>iter_max</td>
<td>
<code>numeric</code>, the maximum number of iterations allowed</td>
</tr>
<tr class="even">
<td>Method</td>
<td>unsupervised</td>
<td>nstart</td>
<td>
<code>numeric</code>, how many random sets of cluster centers should be tried</td>
</tr>
<tr class="odd">
<td>Method</td>
<td>unsupervised</td>
<td>max_centers</td>
<td>
<code>numeric</code>, maximum number of possible clusters when set to auto (the number of clusters is being optimised)</td>
</tr>
</tbody>
</table>
</center>
<p>Modularity was a primary design consideration when building <strong>CITRUS</strong>. This allows you to use certain functions as and when you need them. Below is an overview of some of the different ways the <strong>CITRUS</strong> modules can be used:</p>
</div>
<div id="preprocessing" class="section level3">
<h3 class="hasAnchor">
<a href="#preprocessing" class="anchor"></a>Preprocessing</h3>
<div id="preprocessing-example-1" class="section level4">
<h4 class="hasAnchor">
<a href="#preprocessing-example-1" class="anchor"></a>Preprocessing Example 1</h4>
<p>MVP preprocessing. If nothing other than numeric_operation_list = NA, the preprocessing will default to RFM preprocessing Can be used in e.g. unsupervised learning</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formatted</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/preprocess.html">preprocess</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="reference/transactional_data.html">transactional_data</a></span>, numeric_operation_list <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></code></pre></div>
</div>
<div id="preprocessing-example-2" class="section level4">
<h4 class="hasAnchor">
<a href="#preprocessing-example-2" class="anchor"></a>Preprocessing Example 2</h4>
<p>Aggregating the numeric columns using the ‘min’ and standard deviation ‘sd’. Uses the most common category for each user in the column ‘country’. The target column is the mean of the transactionvalue column.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formatted</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/preprocess.html">preprocess</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="reference/transactional_data.html">transactional_data</a></span>,
                        categories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'country'</span><span class="op">)</span>, 
                        numeric_operation_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'min'</span>, <span class="st">'sd'</span><span class="op">)</span>,
                        target <span class="op">=</span> <span class="st">'desc_chars'</span>, 
                        target_agg <span class="op">=</span> <span class="st">'mean'</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="data-validation" class="section level3">
<h3 class="hasAnchor">
<a href="#data-validation" class="anchor"></a>Data Validation</h3>
<div id="data-validation-example-1" class="section level4">
<h4 class="hasAnchor">
<a href="#data-validation-example-1" class="anchor"></a>Data Validation Example 1</h4>
<p>DF invalid because the ‘customerid’ column is missing</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">invalid_df</span> <span class="op">&lt;-</span> <span class="va">formatted</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">customerid</span><span class="op">)</span>

<span class="fu"><a href="reference/validate.html">validate</a></span><span class="op">(</span><span class="va">invalid_df</span>, supervised <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="data-validation-example-2" class="section level4">
<h4 class="hasAnchor">
<a href="#data-validation-example-2" class="anchor"></a>Data Validation Example 2</h4>
<p>DF invalid because the ‘response’ column is missing and the customerid column is not unique</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">invalid_df</span> <span class="op">&lt;-</span> <span class="va">formatted</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">formatted</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">response</span><span class="op">)</span>

<span class="fu"><a href="reference/validate.html">validate</a></span><span class="op">(</span><span class="va">invalid_df</span>, supervised <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="data-validation-example-3" class="section level4">
<h4 class="hasAnchor">
<a href="#data-validation-example-3" class="anchor"></a>Data Validation Example 3</h4>
<p>DF invalid because only the customerid, and response column exists, there are no feature columns to predict over.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">invalid_df</span> <span class="op">&lt;-</span> <span class="va">formatted</span> <span class="op">%&gt;%</span> 
  <span class="fu">select</span><span class="op">(</span><span class="va">customerid</span>, <span class="va">response</span><span class="op">)</span>

<span class="fu"><a href="reference/validate.html">validate</a></span><span class="op">(</span><span class="va">invalid_df</span>, supervised <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="data-validation-example-4" class="section level4">
<h4 class="hasAnchor">
<a href="#data-validation-example-4" class="anchor"></a>Data Validation Example 4</h4>
<p>Successful validation</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/validate.html">validate</a></span><span class="op">(</span><span class="va">formatted</span>, supervised <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="segment" class="section level3">
<h3 class="hasAnchor">
<a href="#segment" class="anchor"></a>Segment</h3>
<div id="segment-example-1" class="section level4">
<h4 class="hasAnchor">
<a href="#segment-example-1" class="anchor"></a>Segment Example 1</h4>
<p>Runs the default decision tree optimisation function to segment the customers. Skips the ‘preprocess’ step and goes straight from the ‘model’ step and onwards. Instructed to prettify the plot and display it</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/segment.html">segment</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="reference/preprocessed_data.html">preprocessed_data</a></span>, 
                  modeltype <span class="op">=</span> <span class="st">'tree'</span>,
                  steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'model'</span><span class="op">)</span>,
                  prettify <span class="op">=</span> <span class="cn">T</span>,
                  print_plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="segment-example-2" class="section level4">
<h4 class="hasAnchor">
<a href="#segment-example-2" class="anchor"></a>Segment Example 2</h4>
<p>Uses a user defined function to classify the customers Skips the ‘preprocess’ step and goes straight from the ‘model’ step and onwards. No hyper parameters passed</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_custom_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">final_df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>first_letter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substring</a></span><span class="op">(</span><span class="va">top_country</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>persona <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">first_letter</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">8</span>, <span class="st">'Segment A'</span>,
                                      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">first_letter</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">17</span>, <span class="st">'Segment B'</span>, <span class="st">'Segment C'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">customerid</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co">#output &lt;- list('predicted_values' = final_df[,c('persona')])</span>
  <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">'predicted_values'</span> <span class="op">=</span> <span class="va">final_df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'customerid'</span>, <span class="st">'persona'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/segment.html">segment</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="reference/preprocessed_data.html">preprocessed_data</a></span>, 
                  modeltype <span class="op">=</span> <span class="st">'tree'</span>,
                  FUN <span class="op">=</span> <span class="va">my_custom_function</span>,
                  FUN_preprocess <span class="op">=</span> <span class="cn">NULL</span>,
                  steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'model'</span><span class="op">)</span><span class="op">)</span>                  </code></pre></div>
</div>
<div id="segment-example-3" class="section level4">
<h4 class="hasAnchor">
<a href="#segment-example-3" class="anchor"></a>Segment Example 3</h4>
<p>MVP segmentation. Uses both the default preprocess step and the default model step</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/segment.html">segment</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="reference/transactional_data.html">transactional_data</a></span>, prettify <span class="op">=</span> <span class="cn">TRUE</span>, print_plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="segment-example-4" class="section level4">
<h4 class="hasAnchor">
<a href="#segment-example-4" class="anchor"></a>Segment Example 4</h4>
<p>MVP segmentation for unsupervised learning Uses both the default preprocess step and the default model step</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/segment.html">segment</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="reference/transactional_data.html">transactional_data</a></span> <span class="op">%&gt;%</span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">desc_chars</span><span class="op">)</span>, modeltype <span class="op">=</span> <span class="st">'unsupervised'</span>, prettify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="model-abstraction" class="section level3">
<h3 class="hasAnchor">
<a href="#model-abstraction" class="anchor"></a>Model Abstraction</h3>
<div id="model-abstraction-example-1" class="section level4">
<h4 class="hasAnchor">
<a href="#model-abstraction-example-1" class="anchor"></a>Model Abstraction Example 1</h4>
<p>The model abstraction layer takes the output of the model segment layer and extracts the relevant information and converts it into a model class ready for the model management layer.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hyperparameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dependent_variable <span class="op">=</span> <span class="st">'response'</span>,
                       min_segmentation_fraction <span class="op">=</span> <span class="fl">0.05</span>,
                       number_of_personas <span class="op">=</span> <span class="fl">6</span>,
                       print_plot <span class="op">=</span> <span class="cn">FALSE</span>,
                       print_safety_check<span class="op">=</span><span class="fl">20</span><span class="op">)</span>

<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tree_segment.html">tree_segment</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="reference/preprocessed_data.html">preprocessed_data</a></span>, <span class="va">hyperparameters</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tree_segment_prettify.html">tree_segment_prettify</a></span><span class="op">(</span><span class="va">model</span>,print_plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tree_abstract.html">tree_abstract</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="reference/preprocessed_data.html">preprocessed_data</a></span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="model-management" class="section level3">
<h3 class="hasAnchor">
<a href="#model-management" class="anchor"></a>Model Management</h3>
<div id="model-management-example-1" class="section level4">
<h4 class="hasAnchor">
<a href="#model-management-example-1" class="anchor"></a>Model Management Example 1</h4>
<p>The model management layer is used to store the model outputs and relevant metadata, this is defaulted to not save. To get this layer to work, in the hyperparameters at the start, the saveoutput hyperparameter can be changed to save the relevant model outputs.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hyperparameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dependent_variable <span class="op">=</span> <span class="st">'response'</span>,
                       min_segmentation_fraction <span class="op">=</span> <span class="fl">0.05</span>,
                       number_of_personas <span class="op">=</span> <span class="fl">6</span>,
                       print_plot <span class="op">=</span> <span class="cn">FALSE</span>,
                       print_safety_check<span class="op">=</span><span class="fl">20</span>,
                       saveoutput <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tree_segment.html">tree_segment</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="reference/preprocessed_data.html">preprocessed_data</a></span>, <span class="va">hyperparameters</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tree_segment_prettify.html">tree_segment_prettify</a></span><span class="op">(</span><span class="va">model</span>,print_plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tree_abstract.html">tree_abstract</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="reference/preprocessed_data.html">preprocessed_data</a></span><span class="op">)</span>
<span class="fu"><a href="reference/model_management.html">model_management</a></span><span class="op">(</span><span class="va">model</span>,<span class="va">hyperparameters</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="output-layer" class="section level3">
<h3 class="hasAnchor">
<a href="#output-layer" class="anchor"></a>Output Layer</h3>
<div id="output-layer-example-1" class="section level4">
<h4 class="hasAnchor">
<a href="#output-layer-example-1" class="anchor"></a>Output Layer Example 1</h4>
<p>The output layer takes the output of the model segment and abstraction layer and produces the output table.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hyperparameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dependent_variable <span class="op">=</span> <span class="st">'response'</span>,
                       min_segmentation_fraction <span class="op">=</span> <span class="fl">0.05</span>,
                       number_of_personas <span class="op">=</span> <span class="fl">6</span>,
                       print_plot <span class="op">=</span> <span class="cn">FALSE</span>,
                       print_safety_check<span class="op">=</span><span class="fl">20</span><span class="op">)</span>

<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tree_segment.html">tree_segment</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="reference/preprocessed_data.html">preprocessed_data</a></span>, <span class="va">hyperparameters</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tree_segment_prettify.html">tree_segment_prettify</a></span><span class="op">(</span><span class="va">model</span>,print_plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tree_abstract.html">tree_abstract</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="reference/preprocessed_data.html">preprocessed_data</a></span><span class="op">)</span>
<span class="fu"><a href="reference/model_management.html">model_management</a></span><span class="op">(</span><span class="va">model</span>,<span class="va">hyperparameters</span><span class="op">)</span>
<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/output_table.html">output_table</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="reference/preprocessed_data.html">preprocessed_data</a></span>,<span class="va">model</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="pair-plot-vizualisation" class="section level3">
<h3 class="hasAnchor">
<a href="#pair-plot-vizualisation" class="anchor"></a>Pair-plot vizualisation</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formatted</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/preprocess.html">preprocess</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="reference/transactional_data.html">transactional_data</a></span>,
                        categories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'country'</span><span class="op">)</span>, 
                        numeric_operation_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'min'</span>, <span class="st">'sd'</span><span class="op">)</span>,
                        target <span class="op">=</span> <span class="st">'desc_chars'</span>, 
                        target_agg <span class="op">=</span> <span class="st">'mean'</span><span class="op">)</span>

<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/segment.html">segment</a></span><span class="op">(</span><span class="va">formatted</span>, 
                  modeltype <span class="op">=</span> <span class="st">'tree'</span>,
                  steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'model'</span><span class="op">)</span>,
                  prettify <span class="op">=</span> <span class="cn">TRUE</span>,
                  print_plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
                  
<span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/citrus_pair_plot.html">citrus_pair_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">formatted</span>, segments <span class="op">=</span> <span class="va">output</span><span class="op">$</span><span class="va">segments</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"frequency"</span>,<span class="st">"monetary"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="full-workflow" class="section level3">
<h3 class="hasAnchor">
<a href="#full-workflow" class="anchor"></a>Full Workflow</h3>
<p><strong>CITRUS</strong> can be run simply with the <code>segment</code> function or can be more advanced, using each module by line as below.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hyperparameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dependent_variable <span class="op">=</span> <span class="st">'response'</span>,
                       min_segmentation_fraction <span class="op">=</span> <span class="fl">0.05</span>,
                       number_of_personas <span class="op">=</span> <span class="fl">6</span>,
                       print_plot <span class="op">=</span> <span class="cn">FALSE</span>,
                       print_safety_check<span class="op">=</span><span class="fl">20</span><span class="op">)</span>

<span class="va">formatted</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/preprocess.html">preprocess</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="reference/transactional_data.html">transactional_data</a></span>,
                       categories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'country'</span><span class="op">)</span>, 
                       numeric_operation_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'min'</span>, <span class="st">'sd'</span><span class="op">)</span>,
                       target <span class="op">=</span> <span class="st">'desc_chars'</span>, 
                       target_agg <span class="op">=</span> <span class="st">'mean'</span><span class="op">)</span>
<span class="fu"><a href="reference/validate.html">validate</a></span><span class="op">(</span><span class="va">formatted</span>, supervised <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tree_segment.html">tree_segment</a></span><span class="op">(</span><span class="va">formatted</span>, <span class="va">hyperparameters</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tree_segment_prettify.html">tree_segment_prettify</a></span><span class="op">(</span><span class="va">model</span>,print_plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/tree_abstract.html">tree_abstract</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="reference/preprocessed_data.html">preprocessed_data</a></span><span class="op">)</span>
<span class="fu"><a href="reference/model_management.html">model_management</a></span><span class="op">(</span><span class="va">model</span>,<span class="va">hyperparameters</span><span class="op">)</span>
<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/output_table.html">output_table</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="reference/preprocessed_data.html">preprocessed_data</a></span>,<span class="va">model</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="community">
<h2>Community</h2>
<ul class="list-unstyled">
<li><a href="CONTRIBUTING.html">Contributing guide</a></li>
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Dom Clarke <br><small class="roles"> Maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Dom Clarke.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
