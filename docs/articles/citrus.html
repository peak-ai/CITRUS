<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started with CITRUS â€¢ citrus</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with CITRUS">
<meta property="og:description" content="citrus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">citrus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/citrus.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Customisation.html">Customisation</a>
    </li>
    <li>
      <a href="../articles/Data_Validation.html">Data Validation</a>
    </li>
    <li>
      <a href="../articles/KProto.html">K clustering</a>
    </li>
    <li>
      <a href="../articles/Model_Abstraction.html">Model Abstraction</a>
    </li>
    <li>
      <a href="../articles/Model_Management.html">Model Management</a>
    </li>
    <li>
      <a href="../articles/Output_Layer.html">Output Table</a>
    </li>
    <li>
      <a href="../articles/Preprocessing.html">Preprocessing</a>
    </li>
    <li>
      <a href="../articles/Tree.html">Tree</a>
    </li>
    <li>
      <a href="../articles/Visualisations.html">Visualisations</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="citrus_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting started with CITRUS</h1>
            
      
      
      <div class="hidden name"><code>citrus.Rmd</code></div>

    </div>

    
    
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"peak-ai/citrus"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">citrus</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="expected-data-model" class="section level2">
<h2 class="hasAnchor">
<a href="#expected-data-model" class="anchor"></a>Expected Data Model</h2>
<p>In its current state, we are assuming that the input data is a transactions table with 4 required columns (transactionid, id, orderdate, transactionvalue). The preprocess function requires that these fields (or equivalent fields) are named in that manner. The function will raise a warning if these column names are not found.</p>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>Using the segmentation functions could be as simple as calling a one-liner:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segment.html">segment</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/transactional_data.html">transactional_data</a></span>, 
                  modeltype <span class="op">=</span> <span class="st">'tree'</span>,
                  steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'preprocess'</span>,<span class="st">'model'</span><span class="op">)</span>,
                  prettify <span class="op">=</span> <span class="cn">TRUE</span>,
                  print_plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="citrus_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>The above code uses default hyperparameters. There are two types of hyperparameters in this package, global ones and method specific ones. Global ones are independent of the method chosen and the method specific ones are related to the approach taken (eg. size of tree).</p>
<div id="hyperparameters" class="section level3">
<h3 class="hasAnchor">
<a href="#hyperparameters" class="anchor"></a>Hyperparameters</h3>
<p>Hyperparameters can be passed into the functions at any time, most of the modules of the CITRUS pipeline has <code>hyperparameters</code> as a function input. The hyperparameters should be passed as a list as follows</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hyperparameters</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dependent_variable <span class="op">=</span> <span class="st">'response'</span>,
                       min_segmentation_fraction <span class="op">=</span> <span class="fl">0.05</span>,
                       number_of_segments <span class="op">=</span> <span class="fl">6</span>,
                       print_safety_check<span class="op">=</span><span class="fl">20</span><span class="op">)</span></code></pre></div>
<p>or for unsupervised k-means/modes</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hyperparameters</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>centers <span class="op">=</span> <span class="st">'auto'</span>,
                       iter_max <span class="op">=</span> <span class="fl">50</span>,
                       nstart <span class="op">=</span> <span class="fl">5</span>,
                       max_centers <span class="op">=</span> <span class="fl">5</span>, 
                       segmentation_variables <span class="op">=</span> <span class="cn">NULL</span>,
                       standardize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<center>
<table class="table">
<colgroup>
<col width="7%">
<col width="12%">
<col width="22%">
<col width="57%">
</colgroup>
<thead><tr class="header">
<th>Type</th>
<th>Method</th>
<th>Hyperparameter Name</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Global</td>
<td></td>
<td>segmentation_variables</td>
<td>
<code>array</code>, names of all variables to segment on</td>
</tr>
<tr class="even">
<td>Global</td>
<td></td>
<td>saveoutput</td>
<td>
<code>boolean</code>, saves the output to local directory if TRUE</td>
</tr>
<tr class="odd">
<td>Method</td>
<td>tree</td>
<td>dependent_variable</td>
<td>
<code>character</code>, name of the variable to be used as dependent variable</td>
</tr>
<tr class="even">
<td>Method</td>
<td>tree</td>
<td>min_segmentation_fraction</td>
<td>
<code>numeric</code>, the maximum size of the smallest possible segment (0.05 is 5% of the number of customers passed)</td>
</tr>
<tr class="odd">
<td>Method</td>
<td>tree</td>
<td>number_of_segments</td>
<td>
<code>numeric</code>, the number of segments to be produced</td>
</tr>
<tr class="even">
<td>Method</td>
<td>unsupervised</td>
<td>centers</td>
<td>
<code>numeric</code> or <code>string</code>, either the number of clusters, or a set of initial (distinct) cluster centres, or â€˜autoâ€™. When â€˜autoâ€™ is chosen, the number of clusters is optimised</td>
</tr>
<tr class="odd">
<td>Method</td>
<td>unsupervised</td>
<td>iter_max</td>
<td>
<code>numeric</code>, the maximum number of iterations allowed</td>
</tr>
<tr class="even">
<td>Method</td>
<td>unsupervised</td>
<td>nstart</td>
<td>
<code>numeric</code>, how many random sets of cluster centers should be tried</td>
</tr>
<tr class="odd">
<td>Method</td>
<td>unsupervised</td>
<td>max_centers</td>
<td>
<code>numeric</code>, maximum number of possible clusters when set to auto (the number of clusters is being optimised)</td>
</tr>
</tbody>
</table>
</center>
<p>Modularity was a primary design consideration when building <strong>CITRUS</strong>. This allows you to use certain functions as and when you need them. Below is an overview of some of the different ways the <strong>CITRUS</strong> modules can be used:</p>
</div>
<div id="preprocessing" class="section level3">
<h3 class="hasAnchor">
<a href="#preprocessing" class="anchor"></a>Preprocessing</h3>
<div id="preprocessing-example-1" class="section level4">
<h4 class="hasAnchor">
<a href="#preprocessing-example-1" class="anchor"></a>Preprocessing Example 1</h4>
<p>MVP preprocessing. If nothing other than numeric_operation_list = NA, the preprocessing will default to RFM preprocessing if no categorical columns exist in the data set. It can be used in e.g.Â unsupervised learning.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formatted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/preprocess.html">preprocess</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/transactional_data.html">transactional_data</a></span>, numeric_operation_list <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></code></pre></div>
</div>
<div id="preprocessing-example-2" class="section level4">
<h4 class="hasAnchor">
<a href="#preprocessing-example-2" class="anchor"></a>Preprocessing Example 2</h4>
<p>Aggregating the numeric columns using the â€˜minâ€™ and standard deviation â€˜sdâ€™. Uses the most common category for each user in the column â€˜countryâ€™. The target column is the mean of the transactionvalue column.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formatted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/preprocess.html">preprocess</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/transactional_data.html">transactional_data</a></span>,
                        categories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'country'</span><span class="op">)</span>, 
                        numeric_operation_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'min'</span>, <span class="st">'sd'</span><span class="op">)</span>,
                        target <span class="op">=</span> <span class="st">'desc_chars'</span>, 
                        target_agg <span class="op">=</span> <span class="st">'mean'</span><span class="op">)</span>
<span class="co">#&gt; Calculating target values</span></code></pre></div>
</div>
</div>
<div id="data-validation" class="section level3">
<h3 class="hasAnchor">
<a href="#data-validation" class="anchor"></a>Data Validation</h3>
<div id="data-validation-example-1" class="section level4">
<h4 class="hasAnchor">
<a href="#data-validation-example-1" class="anchor"></a>Data Validation Example 1</h4>
<p>DF invalid because the â€˜idâ€™ column is missing</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">invalid_df</span> <span class="op">&lt;-</span> <span class="va">formatted</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">id</span><span class="op">)</span>

<span class="fu"><a href="../reference/validate.html">validate</a></span><span class="op">(</span><span class="va">invalid_df</span>, supervised <span class="op">=</span> <span class="cn">TRUE</span>, hyperparameters <span class="op">=</span> <span class="va">hyperparameters</span><span class="op">)</span>
<span class="co">#&gt; Error in validate(invalid_df, supervised = TRUE, hyperparameters = hyperparameters): </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Columns missing: id</span></code></pre></div>
</div>
<div id="data-validation-example-2" class="section level4">
<h4 class="hasAnchor">
<a href="#data-validation-example-2" class="anchor"></a>Data Validation Example 2</h4>
<p>DF invalid because the â€˜responseâ€™ column is missing and the id column is not unique</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hyperparameters</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dependent_variable <span class="op">=</span> <span class="st">'response'</span>,
                       min_segmentation_fraction <span class="op">=</span> <span class="fl">0.05</span>,
                       number_of_segments <span class="op">=</span> <span class="fl">6</span>,
                       print_safety_check<span class="op">=</span><span class="fl">20</span><span class="op">)</span>

<span class="va">invalid_df</span> <span class="op">&lt;-</span> <span class="va">formatted</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">response</span><span class="op">)</span>

<span class="fu"><a href="../reference/validate.html">validate</a></span><span class="op">(</span><span class="va">invalid_df</span>, supervised <span class="op">=</span> <span class="cn">TRUE</span>,hyperparameters <span class="op">=</span> <span class="va">hyperparameters</span><span class="op">)</span>
<span class="co">#&gt; Error in validate(invalid_df, supervised = TRUE, hyperparameters = hyperparameters): </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Columns missing: response</span></code></pre></div>
</div>
<div id="data-validation-example-3" class="section level4">
<h4 class="hasAnchor">
<a href="#data-validation-example-3" class="anchor"></a>Data Validation Example 3</h4>
<p>DF invalid because only the id, and response column exists, there are no feature columns to predict over.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">invalid_df</span> <span class="op">&lt;-</span> <span class="va">formatted</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">response</span><span class="op">)</span>

<span class="fu"><a href="../reference/validate.html">validate</a></span><span class="op">(</span><span class="va">invalid_df</span>, supervised <span class="op">=</span> <span class="cn">TRUE</span>, hyperparameters <span class="op">=</span> <span class="va">hyperparameters</span><span class="op">)</span>
<span class="co">#&gt; Error in validate(invalid_df, supervised = TRUE, hyperparameters = hyperparameters): </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The dataframe does not contain any feature columns.</span></code></pre></div>
</div>
<div id="data-validation-example-4" class="section level4">
<h4 class="hasAnchor">
<a href="#data-validation-example-4" class="anchor"></a>Data Validation Example 4</h4>
<p>Successful validation</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/validate.html">validate</a></span><span class="op">(</span><span class="va">formatted</span>, supervised <span class="op">=</span> <span class="cn">TRUE</span>, hyperparameters <span class="op">=</span> <span class="va">hyperparameters</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
</div>
</div>
<div id="segment" class="section level3">
<h3 class="hasAnchor">
<a href="#segment" class="anchor"></a>Segment</h3>
<div id="segment-example-1" class="section level4">
<h4 class="hasAnchor">
<a href="#segment-example-1" class="anchor"></a>Segment Example 1</h4>
<p>Runs the default decision tree optimisation function to segment the customers. Skips the â€˜preprocessâ€™ step and goes straight from the â€˜modelâ€™ step and onwards. Instructed to prettify the plot and display it</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segment.html">segment</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/preprocessed_data.html">preprocessed_data</a></span>, 
                  modeltype <span class="op">=</span> <span class="st">'tree'</span>,
                  steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'model'</span><span class="op">)</span>,
                  prettify <span class="op">=</span> <span class="cn">T</span>,
                  print_plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="citrus_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
<div id="segment-example-2" class="section level4">
<h4 class="hasAnchor">
<a href="#segment-example-2" class="anchor"></a>Segment Example 2</h4>
<p>Uses a user defined function to classify the customers Skips the â€˜preprocessâ€™ step and goes straight from the â€˜modelâ€™ step and onwards. No hyper parameters passed</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_custom_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">final_df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>first_letter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substring</a></span><span class="op">(</span><span class="va">top_country</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>segment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">first_letter</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">8</span>, <span class="st">'Segment A'</span>,
                                      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">first_letter</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">17</span>, <span class="st">'Segment B'</span>, <span class="st">'Segment C'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co">#output &lt;- list('predicted_values' = final_df[,c('segment')])</span>
  <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">'predicted_values'</span> <span class="op">=</span> <span class="va">final_df</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'id'</span>, <span class="st">'segment'</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segment.html">segment</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/preprocessed_data.html">preprocessed_data</a></span>, 
                  modeltype <span class="op">=</span> <span class="st">'tree'</span>,
                  FUN <span class="op">=</span> <span class="va">my_custom_function</span>,
                  FUN_preprocess <span class="op">=</span> <span class="cn">NULL</span>,
                  steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'model'</span><span class="op">)</span><span class="op">)</span>                  </code></pre></div>
</div>
<div id="segment-example-3" class="section level4">
<h4 class="hasAnchor">
<a href="#segment-example-3" class="anchor"></a>Segment Example 3</h4>
<p>MVP segmentation. Uses both the default preprocess step and the default model step</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segment.html">segment</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/transactional_data.html">transactional_data</a></span>, prettify <span class="op">=</span> <span class="cn">TRUE</span>, print_plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="citrus_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
<div id="segment-example-4" class="section level4">
<h4 class="hasAnchor">
<a href="#segment-example-4" class="anchor"></a>Segment Example 4</h4>
<p>MVP segmentation for unsupervised learning Uses both the default preprocess step and the default model step</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segment.html">segment</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/transactional_data.html">transactional_data</a></span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">desc_chars</span><span class="op">)</span>, modeltype <span class="op">=</span> <span class="st">'k-clusters'</span>, prettify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Registered S3 method overwritten by 'GGally':</span>
<span class="co">#&gt;   method from   </span>
<span class="co">#&gt;   +.gg   ggplot2</span></code></pre></div>
</div>
</div>
<div id="model-abstraction" class="section level3">
<h3 class="hasAnchor">
<a href="#model-abstraction" class="anchor"></a>Model Abstraction</h3>
<div id="model-abstraction-example-1" class="section level4">
<h4 class="hasAnchor">
<a href="#model-abstraction-example-1" class="anchor"></a>Model Abstraction Example 1</h4>
<p>The model abstraction layer takes the output of the model segment layer and extracts the relevant information and converts it into a model class ready for the model management layer.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hyperparameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dependent_variable <span class="op">=</span> <span class="st">'response'</span>,
                       min_segmentation_fraction <span class="op">=</span> <span class="fl">0.05</span>,
                       number_of_segments <span class="op">=</span> <span class="fl">6</span>,
                       print_plot <span class="op">=</span> <span class="cn">FALSE</span>,
                       print_safety_check<span class="op">=</span><span class="fl">20</span><span class="op">)</span>

<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree_segment.html">tree_segment</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/preprocessed_data.html">preprocessed_data</a></span>, <span class="va">hyperparameters</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree_segment_prettify.html">tree_segment_prettify</a></span><span class="op">(</span><span class="va">model</span>,print_plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="citrus_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree_abstract.html">tree_abstract</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/preprocessed_data.html">preprocessed_data</a></span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="model-management" class="section level3">
<h3 class="hasAnchor">
<a href="#model-management" class="anchor"></a>Model Management</h3>
<div id="model-management-example-1" class="section level4">
<h4 class="hasAnchor">
<a href="#model-management-example-1" class="anchor"></a>Model Management Example 1</h4>
<p>The model management layer is used to store the model outputs and relevant metadata, this is defaulted to not save. To get this layer to work, in the hyperparameters at the start, the saveoutput hyperparameter can be changed to save the relevant model outputs.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hyperparameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dependent_variable <span class="op">=</span> <span class="st">'response'</span>,
                       min_segmentation_fraction <span class="op">=</span> <span class="fl">0.05</span>,
                       number_of_segments <span class="op">=</span> <span class="fl">6</span>,
                       print_plot <span class="op">=</span> <span class="cn">FALSE</span>,
                       print_safety_check<span class="op">=</span><span class="fl">20</span>,
                       saveoutput <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree_segment.html">tree_segment</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/preprocessed_data.html">preprocessed_data</a></span>, <span class="va">hyperparameters</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree_segment_prettify.html">tree_segment_prettify</a></span><span class="op">(</span><span class="va">model</span>,print_plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="citrus_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree_abstract.html">tree_abstract</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/preprocessed_data.html">preprocessed_data</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/model_management.html">model_management</a></span><span class="op">(</span><span class="va">model</span>,<span class="va">hyperparameters</span><span class="op">)</span>
<span class="co">#&gt; agg_png </span>
<span class="co">#&gt;       2</span></code></pre></div>
</div>
</div>
<div id="output-layer" class="section level3">
<h3 class="hasAnchor">
<a href="#output-layer" class="anchor"></a>Output Layer</h3>
<div id="output-layer-example-1" class="section level4">
<h4 class="hasAnchor">
<a href="#output-layer-example-1" class="anchor"></a>Output Layer Example 1</h4>
<p>The output layer takes the output of the model segment and abstraction layer and produces the output table.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hyperparameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dependent_variable <span class="op">=</span> <span class="st">'response'</span>,
                       min_segmentation_fraction <span class="op">=</span> <span class="fl">0.05</span>,
                       number_of_segments <span class="op">=</span> <span class="fl">6</span>,
                       print_plot <span class="op">=</span> <span class="cn">FALSE</span>,
                       print_safety_check<span class="op">=</span><span class="fl">20</span><span class="op">)</span>

<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree_segment.html">tree_segment</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/preprocessed_data.html">preprocessed_data</a></span>, <span class="va">hyperparameters</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree_segment_prettify.html">tree_segment_prettify</a></span><span class="op">(</span><span class="va">model</span>,print_plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="citrus_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree_abstract.html">tree_abstract</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/preprocessed_data.html">preprocessed_data</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/model_management.html">model_management</a></span><span class="op">(</span><span class="va">model</span>,<span class="va">hyperparameters</span><span class="op">)</span>
<span class="fu"><a href="../reference/output_table.html">output_table</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/preprocessed_data.html">preprocessed_data</a></span>,<span class="va">model</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 Ã— 16</span>
<span class="co">#&gt;   segment     n mean_value percentage frequency_mean frequency_range</span>
<span class="co">#&gt;     &lt;int&gt; &lt;int&gt;      &lt;dbl&gt; &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;          </span>
<span class="co">#&gt; 1       1    21       23.7 5.1%                17.6  1 - 84         </span>
<span class="co">#&gt; 2       2    20       28.0 4.9%                15.6  1 - 96         </span>
<span class="co">#&gt; 3       3    21       27.9 5.1%                18.8  2 - 63         </span>
<span class="co">#&gt; 4       4    26       25.4 6.3%                 1.88 1 - 5          </span>
<span class="co">#&gt; 5       5    76       26.2 18.5%               43.4  1 - 297        </span>
<span class="co">#&gt; 6       6   246       26.9 60%                 20.8  1 - 96         </span>
<span class="co">#&gt; # â€¦ with 10 more variables: monetary_mean &lt;dbl&gt;, monetary_range &lt;chr&gt;,</span>
<span class="co">#&gt; #   recency_mean &lt;dbl&gt;, recency_range &lt;chr&gt;, top_country_mode &lt;chr&gt;,</span>
<span class="co">#&gt; #   top_country_top5 &lt;chr&gt;, transactionvalue_min_mean &lt;dbl&gt;,</span>
<span class="co">#&gt; #   transactionvalue_min_range &lt;chr&gt;, transactionvalue_sd_mean &lt;dbl&gt;,</span>
<span class="co">#&gt; #   transactionvalue_sd_range &lt;chr&gt;</span></code></pre></div>
</div>
</div>
<div id="pair-plot-vizualisation" class="section level3">
<h3 class="hasAnchor">
<a href="#pair-plot-vizualisation" class="anchor"></a>Pair-plot vizualisation</h3>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">formatted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/preprocess.html">preprocess</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/transactional_data.html">transactional_data</a></span>,
                        categories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'country'</span><span class="op">)</span>, 
                        numeric_operation_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'min'</span>, <span class="st">'sd'</span><span class="op">)</span>,
                        target <span class="op">=</span> <span class="st">'desc_chars'</span>, 
                        target_agg <span class="op">=</span> <span class="st">'mean'</span><span class="op">)</span>
<span class="co">#&gt; Calculating target values</span>

<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/segment.html">segment</a></span><span class="op">(</span><span class="va">formatted</span>, 
                  modeltype <span class="op">=</span> <span class="st">'tree'</span>,
                  steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'model'</span><span class="op">)</span>,
                  prettify <span class="op">=</span> <span class="cn">TRUE</span>,
                  print_plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="citrus_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R">                  
<span class="fu"><a href="../reference/citrus_pair_plot.html">citrus_pair_plot</a></span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">CitrusModel</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"frequency"</span>,<span class="st">"monetary"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="citrus_files/figure-html/unnamed-chunk-19-2.png" width="700"></p>
</div>
<div id="full-workflow" class="section level3">
<h3 class="hasAnchor">
<a href="#full-workflow" class="anchor"></a>Full Workflow</h3>
<p><strong>CITRUS</strong> can be run simply with the <code>segment</code> function or can be more advanced, using each module by line as below.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hyperparameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dependent_variable <span class="op">=</span> <span class="st">'response'</span>,
                       min_segmentation_fraction <span class="op">=</span> <span class="fl">0.05</span>,
                       number_of_segments <span class="op">=</span> <span class="fl">6</span>,
                       print_plot <span class="op">=</span> <span class="cn">FALSE</span>,
                       print_safety_check<span class="op">=</span><span class="fl">20</span><span class="op">)</span>

<span class="va">formatted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/preprocess.html">preprocess</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/transactional_data.html">transactional_data</a></span>,
                       categories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'country'</span><span class="op">)</span>, 
                       numeric_operation_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'min'</span>, <span class="st">'sd'</span><span class="op">)</span>,
                       target <span class="op">=</span> <span class="st">'desc_chars'</span>, 
                       target_agg <span class="op">=</span> <span class="st">'mean'</span><span class="op">)</span>
<span class="co">#&gt; Calculating target values</span>
<span class="fu"><a href="../reference/validate.html">validate</a></span><span class="op">(</span><span class="va">formatted</span>, supervised <span class="op">=</span> <span class="cn">TRUE</span>, hyperparameters <span class="op">=</span> <span class="va">hyperparameters</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree_segment.html">tree_segment</a></span><span class="op">(</span><span class="va">formatted</span>, <span class="va">hyperparameters</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree_segment_prettify.html">tree_segment_prettify</a></span><span class="op">(</span><span class="va">model</span>,print_plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="citrus_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree_abstract.html">tree_abstract</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/preprocessed_data.html">preprocessed_data</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/model_management.html">model_management</a></span><span class="op">(</span><span class="va">model</span>,<span class="va">hyperparameters</span><span class="op">)</span>
<span class="fu"><a href="../reference/output_table.html">output_table</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/preprocessed_data.html">preprocessed_data</a></span>,<span class="va">model</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 Ã— 16</span>
<span class="co">#&gt;   segment     n mean_value percentage frequency_mean frequency_range</span>
<span class="co">#&gt;     &lt;int&gt; &lt;int&gt;      &lt;dbl&gt; &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;          </span>
<span class="co">#&gt; 1       1    21       23.7 5.1%                17.6  1 - 84         </span>
<span class="co">#&gt; 2       2    20       28.0 4.9%                15.6  1 - 96         </span>
<span class="co">#&gt; 3       3    21       27.9 5.1%                18.8  2 - 63         </span>
<span class="co">#&gt; 4       4    26       25.4 6.3%                 1.88 1 - 5          </span>
<span class="co">#&gt; 5       5    76       26.2 18.5%               43.4  1 - 297        </span>
<span class="co">#&gt; 6       6   246       26.9 60%                 20.8  1 - 96         </span>
<span class="co">#&gt; # â€¦ with 10 more variables: monetary_mean &lt;dbl&gt;, monetary_range &lt;chr&gt;,</span>
<span class="co">#&gt; #   recency_mean &lt;dbl&gt;, recency_range &lt;chr&gt;, top_country_mode &lt;chr&gt;,</span>
<span class="co">#&gt; #   top_country_top5 &lt;chr&gt;, transactionvalue_min_mean &lt;dbl&gt;,</span>
<span class="co">#&gt; #   transactionvalue_min_range &lt;chr&gt;, transactionvalue_sd_mean &lt;dbl&gt;,</span>
<span class="co">#&gt; #   transactionvalue_sd_range &lt;chr&gt;</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Dom Clarke, Cinzia Braglia, Oskar Nummedal, Leo McCarthy, Rebekah Yates, Joash Alonso.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
