<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Output Table • citrus</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Output Table">
<meta property="og:description" content="citrus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">citrus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/citrus.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Customisation.html">Customisation</a>
    </li>
    <li>
      <a href="../articles/Data_Validation.html">Data Validation</a>
    </li>
    <li>
      <a href="../articles/KProto.html">K clustering</a>
    </li>
    <li>
      <a href="../articles/Model_Abstraction.html">Model Abstraction</a>
    </li>
    <li>
      <a href="../articles/Model_Management.html">Model Management</a>
    </li>
    <li>
      <a href="../articles/Output_Layer.html">Output Table</a>
    </li>
    <li>
      <a href="../articles/Preprocessing.html">Preprocessing</a>
    </li>
    <li>
      <a href="../articles/Tree.html">Tree</a>
    </li>
    <li>
      <a href="../articles/Visualisations.html">Visualisations</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Output_Layer_files/header-attrs-2.8/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Output Table</h1>
            
      
      
      <div class="hidden name"><code>Output_Layer.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">citrus</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span></code></pre></div>
<p>The <code>CITRUS</code> package is built in a modular fashion, where the last module of the pipeline is the output table. The purpose of this module is to produce an understandable output from the segmentation models that explains how the input data has been divided.</p>
<p>Currently the output table takes the input data and a segmentation model object as inputs and produces a table displaying the segment number and some summary statistics. The summary statistics are dependent on the variables used to segment that are defined in the <code>segmentation_variables</code> section of the model object, all variables in that list will be aggregated by segment. Depending on the column type, different aggregations are used, for categorical columns, the mode and top 5 categories are calculated for each segment, for numeric columns, the mean and range by segment are provided.</p>
<p>There are visualisations that explain the different segments in a similar way to the table that can be seen in <a href="https://peak-ai.github.io/CITRUS/articles/Visualisations.html" class="uri">https://peak-ai.github.io/CITRUS/articles/Visualisations.html</a></p>
<div id="an-example" class="section level2">
<h2 class="hasAnchor">
<a href="#an-example" class="anchor"></a>An Example</h2>
<p>In order to run the output table, a segmentation model output is required. The below code creates the segmentation model output that is run through the output table function to produce the table displayed.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hyperparameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dependent_variable <span class="op">=</span> <span class="st">'response'</span>,
                       min_segmentation_fraction <span class="op">=</span> <span class="fl">0.05</span>,
                       number_of_personas <span class="op">=</span> <span class="fl">6</span>,
                       print_plot <span class="op">=</span> <span class="cn">FALSE</span>,
                       print_safety_check<span class="op">=</span><span class="fl">20</span><span class="op">)</span>

<span class="va">formatted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/preprocess.html">preprocess</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/transactional_data.html">transactional_data</a></span>,
                       categories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'country'</span><span class="op">)</span>, 
                       numeric_operation_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'min'</span>, <span class="st">'sd'</span><span class="op">)</span>,
                       target <span class="op">=</span> <span class="st">'desc_chars'</span>, 
                       target_agg <span class="op">=</span> <span class="st">'mean'</span><span class="op">)</span>
<span class="co">#&gt; [1] "Please ensure columns are renamed accordingly:"</span>
<span class="co">#&gt; [1] "Customer Identifier: customerid"</span>
<span class="co">#&gt; [1] "Transaction Identifier: transactionid"</span>
<span class="co">#&gt; [1] "Transaction Date: orderdate"</span>
<span class="co">#&gt; [1] "Value Column: transactionvalue"</span>
<span class="co">#&gt; [1] "Target column: desc_chars (mean)"</span>
<span class="co">#&gt; Calculating target values</span>
<span class="fu"><a href="../reference/validate.html">validate</a></span><span class="op">(</span><span class="va">formatted</span>, supervised <span class="op">=</span> <span class="cn">TRUE</span>, hyperparameters <span class="op">=</span> <span class="va">hyperparameters</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree_segment.html">tree_segment</a></span><span class="op">(</span><span class="va">formatted</span>, <span class="va">hyperparameters</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree_segment_prettify.html">tree_segment_prettify</a></span><span class="op">(</span><span class="va">model</span>,print_plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p><img src="Output_Layer_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree_abstract.html">tree_abstract</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/preprocessed_data.html">preprocessed_data</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/model_management.html">model_management</a></span><span class="op">(</span><span class="va">model</span>,<span class="va">hyperparameters</span><span class="op">)</span>
<span class="fu"><a href="../reference/output_table.html">output_table</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/preprocessed_data.html">preprocessed_data</a></span>,<span class="va">model</span><span class="op">)</span>
<span class="co">#&gt; Warning: `summarise_each_()` was deprecated in dplyr 0.7.0.</span>
<span class="co">#&gt; Please use `across()` instead.</span>
<span class="co">#&gt; Warning: `funs()` was deprecated in dplyr 0.8.0.</span>
<span class="co">#&gt; Please use a list of either functions or lambdas: </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   # Simple named list: </span>
<span class="co">#&gt;   list(mean = mean, median = median)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   # Auto named with `tibble::lst()`: </span>
<span class="co">#&gt;   tibble::lst(mean, median)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   # Using lambdas</span>
<span class="co">#&gt;   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))</span>
<span class="co">#&gt; # A tibble: 6 × 16</span>
<span class="co">#&gt;   segment     n mean_value percentage frequency_mean frequency_range</span>
<span class="co">#&gt;     &lt;int&gt; &lt;int&gt;      &lt;dbl&gt; &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;          </span>
<span class="co">#&gt; 1       1    21       23.7 5.1%                17.6  1 - 84         </span>
<span class="co">#&gt; 2       2    20       28.0 4.9%                15.6  1 - 96         </span>
<span class="co">#&gt; 3       3    21       27.9 5.1%                18.8  2 - 63         </span>
<span class="co">#&gt; 4       4    26       25.4 6.3%                 1.88 1 - 5          </span>
<span class="co">#&gt; 5       5    76       26.2 18.5%               43.4  1 - 297        </span>
<span class="co">#&gt; 6       6   246       26.9 60%                 20.8  1 - 96         </span>
<span class="co">#&gt; # … with 10 more variables: monetary_mean &lt;dbl&gt;, monetary_range &lt;chr&gt;,</span>
<span class="co">#&gt; #   recency_mean &lt;dbl&gt;, recency_range &lt;chr&gt;, top_country_mode &lt;chr&gt;,</span>
<span class="co">#&gt; #   top_country_top5 &lt;chr&gt;, transactionvalue_min_mean &lt;dbl&gt;,</span>
<span class="co">#&gt; #   transactionvalue_min_range &lt;chr&gt;, transactionvalue_sd_mean &lt;dbl&gt;,</span>
<span class="co">#&gt; #   transactionvalue_sd_range &lt;chr&gt;</span></code></pre></div>
<p>Currently, the output function is set to produce the above outputs only. Functionality could be added in to customise the output table and provide more default functions or even add custom functions to aggregate on.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Dom Clarke, Leo McCarthy.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
