<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Model Abstraction â€¢ citrus</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Model Abstraction">
<meta property="og:description" content="citrus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">citrus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/citrus.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Customisation.html">Customisation</a>
    </li>
    <li>
      <a href="../articles/Data_Validation.html">Data Validation</a>
    </li>
    <li>
      <a href="../articles/KProto.html">K clustering</a>
    </li>
    <li>
      <a href="../articles/Model_Abstraction.html">Model Abstraction</a>
    </li>
    <li>
      <a href="../articles/Model_Management.html">Model Management</a>
    </li>
    <li>
      <a href="../articles/Output_Layer.html">Output Table</a>
    </li>
    <li>
      <a href="../articles/Preprocessing.html">Preprocessing</a>
    </li>
    <li>
      <a href="../articles/Tree.html">Tree</a>
    </li>
    <li>
      <a href="../articles/Visualisations.html">Visualisations</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Model_Abstraction_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Model Abstraction</h1>
            
      
      
      <div class="hidden name"><code>Model_Abstraction.Rmd</code></div>

    </div>

    
    
<p>The CITRUS package contains several different approaches to segmentation, in order to keep the approaches consistent to produce the same outputs, we require a module that extracts the relevant information from the specific approach. This module is called the model abstraction layer, this provides consistency across the different approaches and ensures the same output is produced moving into the next module.</p>
<p>The model abstraction layer varies for each type of approach as it pulls different information from different approaches. The standard input that it takes is the segmentation model object and the input data that is converted into a list object containing the model, hyperparameters, predicted values and the input data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">citrus</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>

<span class="va">hyperparameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dependent_variable <span class="op">=</span> <span class="st">'response'</span>,
                       min_segmentation_fraction <span class="op">=</span> <span class="fl">0.05</span>,
                       number_of_segments <span class="op">=</span> <span class="fl">6</span>,
                       print_plot <span class="op">=</span> <span class="cn">FALSE</span>,
                       print_safety_check<span class="op">=</span><span class="fl">20</span><span class="op">)</span>

<span class="va">formatted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/preprocess.html">preprocess</a></span><span class="op">(</span><span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/transactional_data.html">transactional_data</a></span>,
                       categories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'country'</span><span class="op">)</span>, 
                       numeric_operation_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'min'</span>, <span class="st">'sd'</span><span class="op">)</span>,
                       target <span class="op">=</span> <span class="st">'desc_chars'</span>, 
                       target_agg <span class="op">=</span> <span class="st">'mean'</span><span class="op">)</span>
<span class="co">#&gt; Calculating target values</span>
<span class="fu"><a href="../reference/validate.html">validate</a></span><span class="op">(</span><span class="va">formatted</span>, supervised <span class="op">=</span> <span class="cn">TRUE</span>, hyperparameters <span class="op">=</span> <span class="va">hyperparameters</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree_segment.html">tree_segment</a></span><span class="op">(</span><span class="va">formatted</span>, <span class="va">hyperparameters</span><span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tree_abstract.html">tree_abstract</a></span><span class="op">(</span><span class="va">model</span>, <span class="fu">citrus</span><span class="fu">::</span><span class="va"><a href="../reference/preprocessed_data.html">preprocessed_data</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>
<span class="co">#&gt; List of 5</span>
<span class="co">#&gt;  $ segment_model        :List of 15</span>
<span class="co">#&gt;   ..$ frame              :'data.frame':  11 obs. of  8 variables:</span>
<span class="co">#&gt;   .. ..$ var       : chr [1:11] "top_country" "&lt;leaf&gt;" "transactionvalue_min" "transactionvalue_sd" ...</span>
<span class="co">#&gt;   .. ..$ n         : int [1:11] 410 21 389 369 348 26 322 76 246 21 ...</span>
<span class="co">#&gt;   .. ..$ wt        : num [1:11] 410 21 389 369 348 26 322 76 246 21 ...</span>
<span class="co">#&gt;   .. ..$ dev       : num [1:11] 3391 342 2855 2704 2569 ...</span>
<span class="co">#&gt;   .. ..$ yval      : num [1:11] 26.6 1 26.8 26.7 26.6 ...</span>
<span class="co">#&gt;   .. ..$ complexity: num [1:11] 0.057 -1 0.0131 0.013 0.0129 ...</span>
<span class="co">#&gt;   .. ..$ ncompete  : int [1:11] 4 0 4 4 4 0 4 0 0 0 ...</span>
<span class="co">#&gt;   .. ..$ nsurrogate: int [1:11] 0 0 1 0 2 0 3 0 0 0 ...</span>
<span class="co">#&gt;   ..$ where              : int [1:410] 9 2 9 8 2 2 2 2 2 2 ...</span>
<span class="co">#&gt;   ..$ call               : language rpart(formula = f, data = df, method = "anova", control = control)</span>
<span class="co">#&gt;   ..$ terms              :Classes 'terms', 'formula'  language response ~ recency + frequency + monetary + transactionvalue_min + transactionvalue_sd +      top_country</span>
<span class="co">#&gt;   .. .. ..- attr(*, "variables")= language list(response, recency, frequency, monetary, transactionvalue_min, transactionvalue_sd,      top_country)</span>
<span class="co">#&gt;   .. .. ..- attr(*, "factors")= int [1:7, 1:6] 0 1 0 0 0 0 0 0 0 1 ...</span>
<span class="co">#&gt;   .. .. .. ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. .. .. .. ..$ : chr [1:7] "response" "recency" "frequency" "monetary" ...</span>
<span class="co">#&gt;   .. .. .. .. ..$ : chr [1:6] "recency" "frequency" "monetary" "transactionvalue_min" ...</span>
<span class="co">#&gt;   .. .. ..- attr(*, "term.labels")= chr [1:6] "recency" "frequency" "monetary" "transactionvalue_min" ...</span>
<span class="co">#&gt;   .. .. ..- attr(*, "order")= int [1:6] 1 1 1 1 1 1</span>
<span class="co">#&gt;   .. .. ..- attr(*, "intercept")= int 1</span>
<span class="co">#&gt;   .. .. ..- attr(*, "response")= int 1</span>
<span class="co">#&gt;   .. .. ..- attr(*, ".Environment")=&lt;environment: 0x7fe3d0f5cc38&gt; </span>
<span class="co">#&gt;   .. .. ..- attr(*, "predvars")= language list(response, recency, frequency, monetary, transactionvalue_min, transactionvalue_sd,      top_country)</span>
<span class="co">#&gt;   .. .. ..- attr(*, "dataClasses")= Named chr [1:7] "numeric" "numeric" "numeric" "numeric" ...</span>
<span class="co">#&gt;   .. .. .. ..- attr(*, "names")= chr [1:7] "response" "recency" "frequency" "monetary" ...</span>
<span class="co">#&gt;   ..$ cptable            : num [1:3, 1:5] 0.0571 0.0131 0.0127 0 1 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. .. ..$ : chr [1:3] "1" "2" "3"</span>
<span class="co">#&gt;   .. .. ..$ : chr [1:5] "CP" "nsplit" "rel error" "xerror" ...</span>
<span class="co">#&gt;   ..$ method             : chr "anova"</span>
<span class="co">#&gt;   ..$ parms              : NULL</span>
<span class="co">#&gt;   ..$ control            :List of 9</span>
<span class="co">#&gt;   .. ..$ minsplit      : num 40</span>
<span class="co">#&gt;   .. ..$ minbucket     : num 20</span>
<span class="co">#&gt;   .. ..$ cp            : num -1</span>
<span class="co">#&gt;   .. ..$ maxcompete    : int 4</span>
<span class="co">#&gt;   .. ..$ maxsurrogate  : int 5</span>
<span class="co">#&gt;   .. ..$ usesurrogate  : int 2</span>
<span class="co">#&gt;   .. ..$ surrogatestyle: int 0</span>
<span class="co">#&gt;   .. ..$ maxdepth      : int 30</span>
<span class="co">#&gt;   .. ..$ xval          : int 10</span>
<span class="co">#&gt;   ..$ functions          :List of 2</span>
<span class="co">#&gt;   .. ..$ summary:function (yval, dev, wt, ylevel, digits)  </span>
<span class="co">#&gt;   .. ..$ text   :function (yval, dev, wt, ylevel, digits, n, use.n)  </span>
<span class="co">#&gt;   ..$ numresp            : int 1</span>
<span class="co">#&gt;   ..$ splits             : num [1:31, 1:5] 410 410 410 378 410 389 389 389 359 389 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. .. ..$ : chr [1:31] "top_country" "transactionvalue_min" "monetary" "transactionvalue_sd" ...</span>
<span class="co">#&gt;   .. .. ..$ : chr [1:5] "count" "ncat" "improve" "index" ...</span>
<span class="co">#&gt;   ..$ csplit             : int [1:2, 1:15] 3 3 1 2 3 3 1 2 1 2 ...</span>
<span class="co">#&gt;   ..$ variable.importance: Named num [1:5] 194.4 89.4 41.4 31.2 12.6</span>
<span class="co">#&gt;   .. ..- attr(*, "names")= chr [1:5] "top_country" "monetary" "transactionvalue_min" "transactionvalue_sd" ...</span>
<span class="co">#&gt;   ..$ y                  : Named num [1:410] 26.8 24.8 26.4 26 28 ...</span>
<span class="co">#&gt;   .. ..- attr(*, "names")= chr [1:410] "1" "2" "3" "4" ...</span>
<span class="co">#&gt;   ..$ ordered            : Named logi [1:6] FALSE FALSE FALSE FALSE FALSE FALSE</span>
<span class="co">#&gt;   .. ..- attr(*, "names")= chr [1:6] "recency" "frequency" "monetary" "transactionvalue_min" ...</span>
<span class="co">#&gt;   ..- attr(*, "xlevels")=List of 1</span>
<span class="co">#&gt;   .. ..$ top_country: chr [1:15] "United Kingdom" "France" "Australia" "Netherlands" ...</span>
<span class="co">#&gt;   ..- attr(*, "class")= chr "rpart"</span>
<span class="co">#&gt;  $ model_hyperparameters:List of 4</span>
<span class="co">#&gt;   ..$ segmentation_variables   : chr [1:6] "recency" "frequency" "monetary" "transactionvalue_min" ...</span>
<span class="co">#&gt;   ..$ dependent_variable       : chr "response"</span>
<span class="co">#&gt;   ..$ min_segmentation_fraction: num 0.05</span>
<span class="co">#&gt;   ..$ number_of_segments       : num 6</span>
<span class="co">#&gt;  $ segment_table        :'data.frame':   6 obs. of  8 variables:</span>
<span class="co">#&gt;   ..$ segment             : int [1:6] 1 2 3 4 5 6</span>
<span class="co">#&gt;   ..$ mean_value          : num [1:6] 23.7 28 27.9 25.4 26.2 ...</span>
<span class="co">#&gt;   ..$ percentage          : num [1:6] 5.12 4.88 5.12 6.34 18.54 ...</span>
<span class="co">#&gt;   ..$ n                   : int [1:6] 21 20 21 26 76 246</span>
<span class="co">#&gt;   ..$ top_country         : chr [1:6] "France, Germany, Netherlands, Portugal, Spain, Switzerland" "Australia, Belgium, EIRE, Italy, Japan, Lithuania, Norway, Poland, United Kingdom" "Australia, Belgium, EIRE, Italy, Japan, Lithuania, Norway, Poland, United Kingdom" "Australia, Belgium, EIRE, Italy, Japan, Lithuania, Norway, Poland, United Kingdom" ...</span>
<span class="co">#&gt;   ..$ transactionvalue_min: chr [1:6] "All" "&lt; -20.375" "&gt; -20.375" "&gt; -20.375" ...</span>
<span class="co">#&gt;   ..$ transactionvalue_sd : chr [1:6] "All" "All" "&lt; 2.55673797922722" "&gt; 2.55673797922722" ...</span>
<span class="co">#&gt;   ..$ monetary            : chr [1:6] "All" "All" "All" "&lt; 86.775" ...</span>
<span class="co">#&gt;  $ predicted_values     :'data.frame':   410 obs. of  2 variables:</span>
<span class="co">#&gt;   ..$ id     : chr [1:410] "12395" "12427" "12431" "12433" ...</span>
<span class="co">#&gt;   ..$ segment: int [1:410] 6 1 6 5 1 1 1 1 1 1 ...</span>
<span class="co">#&gt;  $ input_data           : tibble [410 Ã— 8] (S3: tbl_df/tbl/data.frame)</span>
<span class="co">#&gt;   ..$ id                  : chr [1:410] "12395" "12427" "12431" "12433" ...</span>
<span class="co">#&gt;   ..$ recency             : int [1:410] 4 4 6 6 5 2 1 4 2 6 ...</span>
<span class="co">#&gt;   ..$ frequency           : int [1:410] 12 10 14 73 1 84 1 5 63 20 ...</span>
<span class="co">#&gt;   ..$ monetary            : num [1:410] 346 304 358 1919 -17 ...</span>
<span class="co">#&gt;   ..$ transactionvalue_min: num [1:410] 8.5 12.6 15 5.04 -17 ...</span>
<span class="co">#&gt;   ..$ transactionvalue_sd : num [1:410] 14.7 21.6 11.9 19.5 NA ...</span>
<span class="co">#&gt;   ..$ top_country         : chr [1:410] "Belgium" "Germany" "Australia" "Norway" ...</span>
<span class="co">#&gt;   ..$ response            : num [1:410] 26.8 24.8 26.4 26 28 ...</span>
<span class="co">#&gt;  - attr(*, "class")= chr "tree_model"</span></code></pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Dom Clarke, Cinzia Braglia, Oskar Nummedal, Leo McCarthy, Rebekah Yates, Joash Alonso.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
